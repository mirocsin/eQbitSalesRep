<!DOCTYPE html>
<html>
    <head>
        <title>e-QbitSalesRep</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta charset="utf-8">
        <link rel="stylesheet" href="css/jquery.mobile-1.3.1.min.css" />
        <script src="js/libs/jquery-1.9.1.min.js"></script>
        <script src="js/libs/jquery.mobile-1.3.1.min.js"></script>
        <!--Maps-->
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
        <script type="text/javascript" src="js/libs/jquery.ui.map.js"></script>
        <script type="text/javascript" src="js/libs/jquery.ui.map.services.js"></script>
        <script type="text/javascript" src="js/libs/jquery.ui.map.extensions.js"></script>
        <!--End of Map-->

        <script>
            // Global vars
            var p_dummyvar,
                    p_db,
                    p_urlServer = 'http://localhost:64619/eService.asmx',
                    p_mainpg;

            $(document).ready(function() {
                // Notes: Donot refresh page in the main page, this will cause some problems e.g. the main page will be gone if there is a popup

                // Inject Pages
                injectPage('pg_firstlog.html');
                injectPage('pg_login.html');
                injectPage('pg_empmain.html');
                injectPage('pg_map.html');
                injectPage('pg_appointments.html');

                // Some Dynamic Styles
                if (navigator.platform === 'Win32') {
                    $('#pg_firstlog').attr('style', 'width:30%;margin-left: 35%;margin-top: 15%');
                    $('#pg_login').attr('style', 'min-height:100px;width:40%;margin-left:35%;margin-top:10%');                    
                }   

                // Database
                p_db = window.openDatabase("eqbitsales", "1.0", "eQbitSalesRepDB", 1000 * 1024 * 1024);
                Initialize_Tables();
            });

            function Initialize_Tables() {
                p_db.transaction(function(tx) {
                    //Create Tables
                    tx.executeSql("CREATE TABLE IF NOT EXISTS tblsettings(vchId text,vchUsrnm text,vchPswd text,vchUType text,dtRecordAdded text)");
                    tx.executeSql('CREATE TABLE IF NOT EXISTS tblappointments(vchAppt_Code text,vchAppt_Add1 text,vchAppt_Add2 text,vchAppt_Add3 text,vchAppt_Cntry text,vchAppt_Zip text,vchAppt_Date text,vchAppt_Time text,vchRemarks text,vchCust_Name text,bitPlanned bool,bitVisited bool)');
                    //Check for Table Settings
                    tx.executeSql("SELECT * FROM tblsettings", [], success_settings, error_settings);
                }, errorTA_settings);
            }

            function success_settings(tx, results) {
                var len = results.rows.length;
                if (len === 0) {
                    $.mobile.changePage('#pg_firstlog', {transition: "slidedown", reverse: false});                    
                }
                else {
                    if (p_mainpg === undefined) {
                        $.mobile.changePage('#pg_login', {transition: "slidedown", reverse: false});

                        // Debugging, you can change directly the pages here......
                        //$.mobile.changePage('#pg_empmain', {transition: "slidedown", reverse: false});
                    }
                    else {
                        $.mobile.changePage(p_mainpg, {transition: "slidedown", reverse: false});
                    }
                }
            }

            function errorTA_settings(err) {
                alert("Error processing SQL: " + err.code);
            }

            function error_settings(err) {
                $.mobile.changePage('#pg_firstlog', {transition: "slidedown", reverse: false});
            }

            function injectPage(htmlpage) {
                var $html = getHtmlPage(htmlpage);
                $($html).appendTo($("#divContainer"));
            }
            function getHtmlPage(htmlfile) {
                var strHtml;
                $.ajax({url: htmlfile, async: false, success: function(data) {
                        strHtml = data;
                    }});
                return strHtml;
            }
        </script>
    </head>
    <body>
        <div id="divContainer">           
            <div data-role="page" id="pg_empty">                
            </div>           
        </div>    
    </body>
</html>